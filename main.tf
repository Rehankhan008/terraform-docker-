provider "kubernetes" {
  host                   = "https://kubernetes.docker.internal:6443"
  cluster_ca_certificate = base64decode("LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSURCVENDQWUyZ0F3SUJBZ0lJUUpMSUZOYjIxb0l3RFFZSktvWklodmNOQVFFTEJRQXdGVEVUTUJFR0ExVUUKQXhNS2EzVmlaWEp1WlhSbGN6QWVGdzB5TlRBeE1EZ3hNakEzTWpaYUZ3MHpOVEF4TURZeE1qRXlNalphTUJVeApFekFSQmdOVkJBTVRDbXQxWW1WeWJtVjBaWE13Z2dFaU1BMEdDU3FHU0liM0RRRUJBUVVBQTRJQkR3QXdnZ0VLCkFvSUJBUURpdzdZRVJrajI4MDJjSndhWWxhUFVTbFdoK2xGajE5cEJkaXdNY0Z5RUV6WWp2SW5IdnRkYlBtdGgKMytNQXRIYVB4Z0NnYTh4dkhYRW03K1RuTUlWMVpjTWprWm9PMENzeXJrUUprd0FuMTE5MWJubkwwTmlWSGNnbwpYUlFmSmVKS0UzbC9Oa2ZpZ2hEZ2xBcUNaTU1Kc2Nod3RZUHNIeWxyK1R5ejE3U28rVjNFSHozVi9mV1RmT2JBCmRrd1RRUjQ3UWJZc1dpdmlKSWw4VUdQelp5ZWFLL2tqeGc3WnVPOTQ0Y20yQ2tISGxVdW1FWmFJUjhaOG16S08KZjRFbU42aEVteUNlOEJYNGRmRi9VU01aTW9aTnF0MWljVkwwV0ZURzVhSXFUaGhOZ2Z4cnY4UmtCdGVueTZvNApVZVdMSUNSOGF3bTZFVUY2akpMUUQ1L2FwVk56QWdNQkFBR2pXVEJYTUE0R0ExVWREd0VCL3dRRUF3SUNwREFQCkJnTlZIUk1CQWY4RUJUQURBUUgvTUIwR0ExVWREZ1FXQkJSb0trMUxjVnZ0RXJQNG5ERXVNbGNjTXJPM1dqQVYKQmdOVkhSRUVEakFNZ2dwcmRXSmxjbTVsZEdWek1BMEdDU3FHU0liM0RRRUJDd1VBQTRJQkFRQmlpMjZDOWN6aQo0aEN4Lzh3YnlWbFphWUlMT1Y0WThRdFhXZmRaRjFTb2xVOWFjYnAzYkdCSThqMDRqY1FqMmxrVFE5Q1pUK3lrCnhWMklMNEJLcTluRmJtSWlKUHY2QmlpWXkzR0JVSWY4WEF1b1VUeG1MdDdTTmhMOWE4Tm5tWi9SQlBhdURENFgKYXR0Z1NtWS9PRlVEZ0lOTm41ejI3YzNhQ1BWOTZZellEMWsrblBWeUZENWM2bG5TZktidFA4TTNZSFR2blhMRwo0TkZFWXJpaXFxbFFqRExieUcyeXNrVG5ZWWRTajV5dUNSenhtTVFNM29SMWw5Z3lBTDdDdXFjZHB5QWY5eFE5CnBPVnVqakV1QmlMSWxqamd2MXdGeHZHcG9tTnY5STl4SFNibFExVGZoVHh5M2lxa1BQdWlMWnhlWXVlaUtOTEoKTHRmYlEzSjVwdFZICi0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0K")
  client_certificate     = base64decode("LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSURCVENDQWUyZ0F3SUJBZ0lJUUpMSUZOYjIxb0l3RFFZSktvWklodmNOQVFFTEJRQXdGVEVUTUJFR0ExVUUKQXhNS2EzVmlaWEp1WlhSbGN6QWVGdzB5TlRBeE1EZ3hNakEzTWpaYUZ3MHlOakF4TURneE1qRXlNamhhTURZeApGekFWQmdOVkJBb1REbk41YzNSbGJUcHRZWE4wWlhKek1Sc3dHUVlEVlFRREV4SmtiMk5yWlhJdFptOXlMV1JsCmMydDBiM0F3Z2dFaU1BMEdDU3FHU0liM0RRRUJBUVVBQTRJQkR3QXdnZ0VLQW9JQkFRQy91MUo1WVFJWDg2ZWcKa2xxcE00TjZlbjFrcXphYnlVNHlkb25UWWIvYjE5dUo5eUxIWTU3RjJ6aHpxOUdXWTZCeGNPYnZDS0hIcHR4QQo3YktxSzZXdFYrVFJBQlR3MmZCTnA4OE0xaXA1NC91K3JTejErbk12cUJYZzdPZStCMlpEbytJMGRUVGhma0VBClJSYjJaS3Y2TEJNcnE2RkRtMXZDMzBTYWhKSFB5aWUwa2VPUStuY25IeTAxY1ZIM0JUQU53S2lnMDVRM01mWGEKYVdRYlZVdXpYSzNtaCt2Z3QwYTV5Y0NiSWU4dGN6enVnWFhRdlg4SGhIaWxnT2huVkZWSzNtRU02SDU5bVhQSApLaFdzbUNYcXZwQ1hVM24zNzVqdUJoVUdnYjFOb0xIZVdkU2xBeGMvQzJPS1crSDFWYnRjNmRTMS9LY21EVE5wCmZVelJRTlIxQWdNQkFBR2pkVEJ6TUE0R0ExVWREd0VCL3dRRUF3SUZvREFUQmdOVkhTVUVEREFLQmdnckJnRUYKQlFjREFqQU1CZ05WSFJNQkFmOEVBakFBTUI4R0ExVWRJd1FZTUJhQUZHZ3FUVXR4VyswU3MvaWNNUzR5Vnh3eQpzN2RhTUIwR0ExVWRFUVFXTUJTQ0VtUnZZMnRsY2kxbWIzSXRaR1Z6YTNSdmNEQU5CZ2txaGtpRzl3MEJBUXNGCkFBT0NBUUVBV3hOQUk5ME53dDVQOHI1cnhxR2JPWEpiVzhrdmpZZUlOTjVMRHVaWnZpRW5ZR3ZNUGJJbTUyc1AKaEpLeGNBZUhZVzVZU242N2tOc3NKZ0pBMXkyVkZmR0xrREI0M21ibVlUNkZPenF0NHo0aU56dGxHRHQyMXEwNwpvVWhiemxUMDQ2YmcrTTBkTEp2VjFpVWdHZlZwekk2TFMzOFVYcUg4NmR2ZDFEa2N6bFA0aDE1Q1d5bFhqS2RqCjJVT0xaVDdJS29oZGhVWmpYaEMvK25sM2dGWlkwdFB5WUE3Nnlmd0ZwZUpFTmFXa3hFUWhpbWdCV2pBY0FwMFEKekZHdmVmbU1rV0pOalhGY0tXOVY0TjAyMzhRRzQ4QkdDajhDRjBJcmVhbG40KzRPR1dJbXRJRFQzWmg1T1lLTgpkWE4vOGozMndpTUlWNEtjWlhMTUFQWnRPVnNlb0wzQlNPNkR3UXFZcEczZTQyUlBhSjhFMjZ6SiK6htg9cpgTYyG7kzvK2rBl")
  client_key             = base64decode("LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSURCVENDQWUyZ0F3SUJBZ0lJUUpMSUZOYjIxb0l3RFFZSktvWklodmNOQVFFTEJRQXdGVEVUTUJFR0ExVUUKQXhNS2EzVmlaWEp1WlhSbGN6QWVGdzB5TlRBeE1EZ3hNakEzTWpaYUZ3MHlOakF4TURneE1qRXlNamhhTURZeApGekFWQmdOVkJBb1REbk41YzNSbGJUcHRZWE4wWlhKek1Sc3dHUVlEVlFRREV4SmtiMk5yWlhJdFptOXlMV1JsCmMydDBiM0F3Z2dFaU1BMEdDU3FHU0liM0RRRUJBUVVBQTRJQkR3QXdnZ0VLQW9JQkFRQy91MUo1WVFJWDg2ZWcKa2xxcE00TjZlbjFrcXphYnlVNHlkb25UWWIvYjE5dUo5eUxIWTU3RjJ6aHpxOUdXWTZCeGNPYnZDS0hIcHR4QQo3YktxSzZXdFYrVFJBQlR3MmZCTnA4OE0xaXA1NC91K3JTejErbk12cUJYZzdPZStCMlpEbytJMGRUVGhma0VBClJSYjJaS3Y2TEJNcnE2RkRtMXZDMzBTYWhKSFB5aWUwa2VPUStuY25IeTAxY1ZIM0JUQU53S2lnMDVRM01mWGEKYVdRYlZVdXpYSzNtaCt2Z3QwYTV5Y0NiSWU4dGN6enVnWFhRdlg4SGhIaWxnT2huVkZWSzNtRU02SDU5bVhQSApLaFdzbUNYcXZwQ1hVM24zNzVqdUJoVUdnYjFOb0xIZVdkU2xBeGMvQzJPS1crSDFWYnRjNmRTMS9LY21EVE5wCmZVelJRTlIxQWdNQkFBR2pkVEJ6TUE0R0ExVWREd0VCL3dRRUF3SUZvREFUQmdOVkhTVUVEREFLQmdnckJnRUYKQlFjREFqQU1CZ05WSFJNQkFmOEVBakFBTUI4R0ExVWRJd1FZTUJhQUZHZ3FUVXR4VyswU3MvaWNNUzR5Vnh3eQpzN2RhTUIwR0ExVWRFUVFXTUJTQ0VtUnZZMnRsY2kxbWIzSXRaR1Z6YTNSdmNEQU5CZ2txaGtpRzl3MEJBUXNGCkFBT0NBUUVBV3hOQUk5ME53dDVQOHI1cnhxR2JPWEpiVzhrdmpZZUlOTjVMRHVaWnZpRW5ZR3ZNUGJJbTUyc1AKaEpLeGNBZUhZVzVZU242N2tOc3NKZ0pBMXkyVkZmR0xrREI0M21ibVlUNkZPenF0NHo0aU56dGxHRHQyMXEwNwpvVWhiemxUMDQ2YmcrTTBkTEp2VjFpVWdHZlZwekk2TFMzOFVYcUg4NmR2ZDFEa2N6bFA0aDE1Q1d5bFhqS2RqCjJVT0xaVDdJS29oZGhVWmpYaEMvK25sM2dGWlkwdFB5WUE3Nnlmd0ZwZUpFTmFXa3hFUWhpbWdCV2pBY0FwMFEKekZHdmVmbU1rV0pOalhGY0tXOVY0TjAyMzhRRzQ4QkdDajhDRjBJcmVhbG40KzRPR1dJbXRJRFQzWmg1T1lLTgpkWE4vOGozMndpTUlWNEtjWlhMTUFQWnRPVnNlb0wzQlNPNkR3UXFZcEczZTQyUlBhSjhFMjZ6SiK6htg9cpgTYyG7kzvK2rBl")
}


resource "kubernetes_pod" "nginx" {
  metadata {
    name = "terraform-example"
    labels = {
      app = "nginx"
    }
  }

  spec {
    container {
      image = "nginx:1.23.2"
      name  = "example"
    }
  }
}

resource "kubernetes_service" "nginx" {
  metadata {
    name = "terraform-example"
  }
  spec {
    selector = {
      app = kubernetes_pod.nginx.metadata.0.labels.app
    }
    port {
      port        = 80
    }

    type = "NodePort"
  }

  depends_on = [
    kubernetes_pod.nginx
  ]
}
